---
layout:     post
title:      Android 网络共享
subtitle:   Tethering
date:       2021-07-03
author:     LXG
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - netd
---

[网络共享-AOSP](https://source.android.google.cn/devices/architecture/modular-system/tethering)

[rk-ethernet-github](https://github.com/Poco-Ye/rk-ethernet)

[RK3288-7.1下实现4G路由功能-CSDN](https://blog.csdn.net/layuetian2011/article/details/108444577)

## 移动网络共享到以太网

RK3288 android 7.1

1. 实现4G和以太网共存---《Android 支持双以太网卡补丁20180108》
2. 再把4G信号通过iptables实现路由转发

## 开启双以太网共存

**adb shell setprop persist.net.ethernet.mode multi**

## adb路由转发

1. ip rule add from all lookup main pref 9999
2. ifconfig eth0 down
3. ifconfig eth0 up
4. busybox ifconfig eth0 192.168.43.1
5. ndc netd 5003 tether start 192.168.43.2 192.168.43.254 
6. ndc netd 7 nat enable eth0 usb0 2 10.80.71.155/24
7. echo 1 > /proc/sys/net/ipv4/ip_forward
8. getprop | grep dns
9. iptables -t nat -I PREROUTING -i eth0 -p udp --dport 53 -j DNAT --to-destination 120.196.165.7(usb0 dns)

## ifconfig

### 网络共享前

```txt

$ ifconfig
lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0 
          inet6 addr: ::1/128 Scope: Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:10 errors:0 dropped:0 overruns:0 frame:0 
          TX packets:10 errors:0 dropped:0 overruns:0 carrier:0 
          collisions:0 txqueuelen:1 
          RX bytes:762 TX bytes:762 

eth0      Link encap:Ethernet  HWaddr 8a:5b:57:f2:44:77
          inet6 addr: fe80::885b:57ff:fef2:4477/64 Scope: Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2 errors:0 dropped:0 overruns:0 frame:0 
          TX packets:56 errors:0 dropped:0 overruns:0 carrier:0 
          collisions:0 txqueuelen:1000 
          RX bytes:700 TX bytes:14176 
          Interrupt:42 

usb0      Link encap:Ethernet  HWaddr ae:0c:29:a3:9b:6d
          inet addr:10.52.206.88  Bcast:10.255.255.255  Mask:255.0.0.0 
          inet6 addr: fe80::ac0c:29ff:fea3:9b6d/64 Scope: Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1479 errors:0 dropped:0 overruns:0 frame:0 
          TX packets:1718 errors:0 dropped:0 overruns:0 carrier:0 
          collisions:0 txqueuelen:1000 
          RX bytes:123222 TX bytes:180776 

```

### 网络共享后

```txt

# ifconfig
lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0 
          inet6 addr: ::1/128 Scope: Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:2 errors:0 dropped:0 overruns:0 frame:0 
          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0 
          collisions:0 txqueuelen:1 
          RX bytes:106 TX bytes:106 

eth0      Link encap:Ethernet  HWaddr 8a:5b:57:f2:44:77
          inet addr:192.168.43.1  Bcast:192.168.43.255  Mask:255.255.255.0 
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:735 errors:0 dropped:0 overruns:0 frame:0 
          TX packets:802 errors:0 dropped:0 overruns:0 carrier:0 
          collisions:0 txqueuelen:1000 
          RX bytes:84584 TX bytes:965347 
          Interrupt:42 

usb0      Link encap:Ethernet  HWaddr ae:0c:29:a3:9b:6d
          inet addr:10.129.70.7  Bcast:10.255.255.255  Mask:255.0.0.0 
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1274 errors:0 dropped:0 overruns:0 frame:0 
          TX packets:1247 errors:0 dropped:0 overruns:0 carrier:0 
          collisions:0 txqueuelen:1000 
          RX bytes:1390060 TX bytes:135432

```




