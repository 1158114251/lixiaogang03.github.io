---
layout:     post
title:      RK3399驱动移植记录
subtitle:   android R(11)
date:       2022-11-21
author:     LXG
header-img: img/post-bg-android.jpg
catalog: true
tags:
    - rockchip
---

## rockchip-io-domain.txt

kernel/Documentation/devicetree/bindings/power/rockchip-io-domain.txt

支持配置的两种电压1.8v / 3.3v:

* 寄存器配置成1,一般对应的电压范围是 1.62v ~ 1.98v,typical 电压1.8v;
* 寄存器配置成0,一般对应的电压范围是 3.00v ~ 3.60v,typical 电压3.3v。

Possible supplies for rk3399:
- bt656-supply:  The supply connected to APIO2_VDD.
- audio-supply:  The supply connected to APIO5_VDD.
- sdmmc-supply:  The supply connected to SDMMC0_VDD.
- gpio1830-supply:  The supply connected to APIO4_VDD.

Possible supplies for rk3399 pmu-domains:
- pmu1830-supply:The supply connected to PMUIO2_VDD.

## RK3399 IO 电源域配置说明

Rockchip_RK3399_Introduction_IO_Power_Domains_Configuration.pdf

Rockchip_Developer_Guide_Linux_IO_DOMAIN_CN.pdf

主控电源域的IO电平要与对接外设芯片的IO电平保持一致,还要注意软件的电压配置要跟硬件的电压一致,否则,最坏的情况可能会导致IO的损坏

**修改前**

```c

&io_domains {
	status = "okay";

	bt656-supply = <&vcc1v8_dvp>;          // 对应原理图 APIO2_VDD
	audio-supply = <&vcca1v8_codec>;       // 对应原理图 APIO5_VDD
	sdmmc-supply = <&vcc_sd>;              // 对应原理图 SDMMC0_VDD
	gpio1830-supply = <&vcc_3v0>;          // 对应原理图 APIO4_VDD
};

&pmu_io_domains {
	status = "okay";
	pmu1830-supply = <&vcc1v8_pmu>;        // 对应原理图 PMUIO2_VDD
};

```

**查看原理图**

![rk3399_pmuio](/images/rockchip/rk3399_pmuio.png)

**修改后**

```c

&io_domains {
	status = "okay";

	bt656-supply = <&vcc1v8_dvp>;
	audio-supply = <&vcca1v8_codec>;
	sdmmc-supply = <&vcc_sd>;
	gpio1830-supply = <&vcc_3v0>;
};

&pmu_io_domains {
	status = "okay";
	pmu1830-supply = <&vcc_3v0>;  // 此处需要修改
};

```
