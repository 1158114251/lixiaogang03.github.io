---
layout:     post
title:      Allwinner A33
subtitle:   全志 A33
date:       2021-04-10
author:     LXG
header-img: img/post-bg-android.jpg
catalog: true
tags:
    - A33
---

[www.allwinnertech.com](https://www.allwinnertech.com/index.php)

## android 6 系统签名替换

[AOSP系统签名的生成以及替换-Android](https://www.jianshu.com/p/bb5325760506)

```txt

build/target/product/security$ tree -L 1
.
├── Android.mk
├── media.pk8
├── media.x509.pem
├── platform.pk8         私钥
├── platform.x509.pem    公钥
├── README
├── shared.pk8
├── shared.x509.pem
├── testkey.pk8
├── testkey.x509.pem
├── verity_key
├── verity.pk8
└── verity.x509.pem

```

## README

```txt

The following commands were used to generate the test key pairs:

  development/tools/make_key testkey  '/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'
  development/tools/make_key platform '/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'
  development/tools/make_key shared   '/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'
  development/tools/make_key media    '/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'

The following standard test keys are currently included:

testkey -- a generic key for packages that do not otherwise specify a key.
platform -- a test key for packages that are part of the core platform.
shared -- a test key for things that are shared in the home/contacts process.
media -- a test key for packages that are part of the media/download system.

These test keys are used strictly in development, and should never be assumed
to convey any sort of validity.  When $BUILD_SECURE=true, the code should not
honor these keys in any context.


signing using the openssl commandline (for boot/system images)
--------------------------------------------------------------

1. convert pk8 format key to pem format
   % openssl pkcs8 -inform DER -nocrypt -in testkey.pk8 -out testkey.pem

2. create a signature using the pem format key
   % openssl dgst -binary -sha1 -sign testkey.pem FILE > FILE.sig

extracting public keys for embedding
------------------------------------
it's a Java tool
but it generates C code
take a look at commands/recovery/Android.mk
you'll see it running $(HOST_OUT_JAVA_LIBRARIES)/dumpkey.jar

```

## 自定义签名信息

development/tools/make_key platform '/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'

* C —> Country Name (2 letter code)
* ST —> State or Province Name (full name)
* L —> Locality Name (eg, city)
* O —> Organization Name (eg, company)
* OU —> Organizational Unit Name (eg, section)
* CN —> Common Name (eg, your name or your server’s hostname)
* emailAddress —> Contact email address

## 签名制作脚本

[签名版本以供发布](https://source.android.google.cn/devices/tech/ota/sign_builds?hl=zh-cn)

development/tools/make_key

```txt

subject='/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'
mkdir ~/.android-certs
for x in releasekey platform shared media; do \
    ./development/tools/make_key ~/.android-certs/$x "$subject"; \
  done

```

## 编译问题

```txt

a33-6.0v2.1/vendor/softwinner$ ./build.sh 
INFO: ----------------------------------------
INFO: build lichee ...
INFO: chip: sun8iw5p1
INFO: platform: android
INFO: kernel: linux-3.4
INFO: board: dvk4
INFO: output: out/sun8iw5p1/android/dvk4
INFO: ----------------------------------------
INFO: build buildroot ...
external toolchain has been installed
INFO: build buildroot OK.
INFO: build kernel ...
INFO: prepare toolchain ...
Building kernel
/home/lxg/code/code/project/a33_android_6.0/a33-6.0v2.1/vendor/softwinner/linux-3.4/output/lib/modules/3.4.39
cp: 无法获取'rootfs.cpio.gz' 的文件状态(stat): 没有那个文件或目录
ERROR: build kernel Failed

```






