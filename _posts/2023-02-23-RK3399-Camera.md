---
layout:     post
title:      RK3399 Camera
subtitle:   Android R(11)
date:       2023-02-23
author:     LXG
header-img: img/post-bg-digital-native.jpg
catalog: true
tags:
    - camera
---

[Camera 使用-firefly](https://wiki.t-firefly.com/zh_CN/AIO-3399J/driver_camera.html)

[豪威集团-上海韦尔半导体股份有限公司](https://www.omnivision-group.com/company-introduce)

## Ov8858

OV: OmniVision 豪威集团 

全球CMOS图像传感器厂商:

1. 索尼 IMX
2. 三星
3. 豪威科技 OmniVision
4. SK海力士
5. 格科微 : 多名硅谷归国技术人员于2003年12月创立的外商独资企业
6. 思比科 : 归国留学人员创办的专门从事CMOS图像传感器芯片设计、生产及销售的国家级高新技术企业
7. 思特威
8. 比亚迪微电子

## 驱动 android 7

**配置**

rk3399-android.dtsi

```c

	isp0: isp@ff910000 {
		compatible = "rockchip,rk3399-isp", "rockchip,isp";
		reg = <0x0 0xff910000 0x0 0x4000>;
		interrupts = <GIC_SPI 43 IRQ_TYPE_LEVEL_HIGH 0>;
		assigned-clocks = <&cru SCLK_CIF_OUT_SRC>;
		assigned-clock-parents = <&cru PLL_GPLL>;
		assigned-clock-rates = <800000000>;
		clocks =
			<&cru SCLK_CIF_OUT>, <&cru SCLK_CIF_OUT_SRC>,
			<&cru SCLK_DPHY_TX1RX1_CFG>, <&cru SCLK_MIPIDPHY_REF>,
			<&cru ACLK_ISP0_NOC>, <&cru ACLK_ISP0_WRAPPER>,
			<&cru HCLK_ISP0_NOC>, <&cru HCLK_ISP0_WRAPPER>,
			<&cru SCLK_ISP0>, <&cru SCLK_DPHY_RX0_CFG>;
		clock-names =
			"clk_cif_out", "clk_cif_pll",
			"pclk_dphytxrx", "pclk_dphy_ref",
			"aclk_isp0_noc", "aclk_isp0_wrapper",
			"hclk_isp0_noc", "hclk_isp0_wrapper",
			"clk_isp0", "pclk_dphyrx";
		resets = <&cru SRST_H_ISP0>, <&cru SRST_ISP0>;
		reset-names = "h_isp0", "isp0";
		pinctrl-names =
			"cif_clkout", "isp_dvp8bit0", "isp_mipi_fl",
			"isp_mipi_fl_prefl", "isp_flash_as_gpio",
			"isp_flash_as_trigger_out";
		pinctrl-0 = <&cif_clkout>;
		pinctrl-1 = <&cif_clkout &isp_dvp_d0d7>;
		pinctrl-2 = <&cif_clkout>;
		pinctrl-3 = <&cif_clkout &isp_prelight>;
		pinctrl-4 = <&isp_flash_trigger_as_gpio>;
		pinctrl-5 = <&isp_flash_trigger>;
		rockchip,isp,mipiphy = <2>;
		rockchip,isp,cifphy = <1>;
		rockchip,isp,dsiphy,reg = <0xff968000 0x8000>;
		rockchip,grf = <&grf>;
		rockchip,cru = <&cru>;
		rockchip,gpios = <&gpio1 22 GPIO_ACTIVE_HIGH>;
		rockchip,isp,iommu-enable = <1>;
		power-domains = <&power RK3399_PD_ISP0>;
		iommus = <&isp0_mmu>;
		status = "disabled";
	};

	isp1: isp@ff920000 {
		compatible = "rockchip,rk3399-isp", "rockchip,isp";
		reg = <0x0 0xff920000 0x0 0x4000>;
		interrupts = <GIC_SPI 44 IRQ_TYPE_LEVEL_HIGH 0>;
		clocks =
			<&cru ACLK_ISP1_NOC>, <&cru ACLK_ISP1_WRAPPER>,
			<&cru HCLK_ISP1_NOC>, <&cru HCLK_ISP1_WRAPPER>,
			<&cru SCLK_ISP1>, <&cru SCLK_CIF_OUT>,
			<&cru SCLK_CIF_OUT_SRC>, <&cru SCLK_DPHY_TX1RX1_CFG>,
			<&cru SCLK_MIPIDPHY_REF>, <&cru PCLK_ISP1_WRAPPER>,
			<&cru SCLK_DPHY_RX0_CFG>, <&cru PCLK_MIPI_DSI1>,
			<&cru SCLK_MIPIDPHY_CFG>;
		clock-names =
			"aclk_isp1_noc", "aclk_isp1_wrapper",
			"hclk_isp1_noc", "hclk_isp1_wrapper",
			"clk_isp1", "clk_cif_out",
			"clk_cif_pll", "pclk_dphytxrx",
			"pclk_dphy_ref", "pclk_isp1",
			"pclk_dphyrx", "pclk_mipi_dsi",
			"mipi_dphy_cfg";
		resets = <&cru SRST_H_ISP1>, <&cru SRST_ISP1>;
		reset-names = "h_isp1", "isp1";
		pinctrl-names =
			"cif_clkout", "isp_dvp8bit0", "isp_mipi_fl",
			"isp_mipi_fl_prefl", "isp_flash_as_gpio",
			"isp_flash_as_trigger_out";
		pinctrl-0 = <&cif_clkout>;
		pinctrl-1 = <&isp_dvp_d0d7>;
		pinctrl-2 = <&cif_clkout>;
		pinctrl-3 = <&isp_prelight>;
		pinctrl-4 = <&isp_flash_trigger_as_gpio>;
		pinctrl-5 = <&isp_flash_trigger>;
		rockchip,isp,mipiphy = <2>;
		rockchip,isp,cifphy = <1>;
		rockchip,isp,dsiphy,reg = <0xff968000 0x8000>;
		rockchip,grf = <&grf>;
		rockchip,cru = <&cru>;
		rockchip,gpios = <&gpio1 22 GPIO_ACTIVE_HIGH>;
		rockchip,isp,iommu-enable = <1>;
		power-domains = <&power RK3399_PD_ISP1>;
		iommus = <&isp1_mmu>;
		status = "disabled";
	};

&isp0 {
        status = "okay";
};
&isp1 {
        status = "okay";
};

```

**代码**

kernel/drivers/media/video/rk_camsys

```txt

├── camsys_cif.c
├── camsys_cif.h
├── camsys_drv.c
├── camsys_gpio.h
├── camsys_internal.h
├── camsys_marvin.c
├── camsys_marvin.h
├── camsys_mipicsi_phy.c
├── camsys_mipicsi_phy.h
├── camsys_soc_priv.c
├── camsys_soc_priv.h
├── camsys_soc_rk3288.c
├── camsys_soc_rk3288.h
├── camsys_soc_rk3326.c
├── camsys_soc_rk3326.h
├── camsys_soc_rk3366.c
├── camsys_soc_rk3366.h
├── camsys_soc_rk3368.c
├── camsys_soc_rk3368.h
├── camsys_soc_rk3399.c
├── camsys_soc_rk3399.h
├── ext_flashled_drv
│   ├── flashlight.c
│   ├── flashlight.h
│   ├── Kconfig
│   ├── leds-rt8547.c
│   ├── leds-rt8547.h
│   ├── Makefile
│   ├── rk_ext_fshled_ctl.c
│   ├── rk_ext_fshled_ctl.h
│   ├── rtfled.c
│   └── rtfled.h
├── Kconfig
└── Makefile

```

## HAL

hardware/rockchip/camera

```txt

├── Android.mk
├── CameraHal                  // 摄像头的 HAL 源码
│   ├── Android.mk
│   ├── AppMsgNotifier.cpp
│   ├── CameraAdapter.cpp
│   ├── CameraBuffer.cpp
│   ├── CameraDeinterlace.cpp
│   ├── CameraGLAdapter.cpp
│   ├── CameraGLAdapter.h
│   ├── CameraGL.h
│   ├── CameraHal_board_xml_parse.cpp
│   ├── CameraHal_board_xml_parse.h
│   ├── CameraHal.cpp
│   ├── CameraHal.h
│   ├── CameraHal_MediaProfile.cpp
│   ├── CameraHal_Mem.cpp
│   ├── CameraHal_Mem.h
│   ├── CameraHal_Module.cpp
│   ├── CameraHal_Module.h
│   ├── CameraHal_Tracer.c
│   ├── CameraHal_Tracer.h
│   ├── CameraHalUtil.cpp
│   ├── CameraIspAdapter.cpp
│   ├── CameraIspAdapter.h
│   ├── CameraIspSOCAdapter.cpp
│   ├── CameraIspTunning.cpp
│   ├── CameraIspTunning.h
│   ├── camera_mem.cpp
│   ├── camera_mem_gralloc.cpp
│   ├── camera_mem.h
│   ├── CameraSocAdapter.cpp
│   ├── CameraUSBAdapter.cpp
│   ├── common_type.h
│   ├── DisplayAdapter.cpp
│   ├── FaceDetector.h
│   ├── FakeCameraAdapter.cpp
│   ├── FakeCameraAdapter.h
│   ├── Jpeg_soft_encode.cpp
│   ├── lib
│   ├── MessageQueue.cpp
│   ├── MessageQueue.h
│   ├── MutliFrameDenoise.h
│   ├── Semaphore.cpp
│   ├── Semaphore.h
│   ├── SensorListener.cpp
│   └── SensorListener.h
├── Config
│   ├── Android.mk
│   ├── cam_board_rk3288.xml
│   ├── cam_board_rk3326.xml
│   ├── cam_board_rk3366.xml
│   ├── cam_board_rk3368.xml
│   ├── cam_board_rk3399.xml                  // 摄像头的参数设置
│   ├── lib_rkisp12_api_7x_32bit.so
│   ├── lib_rkisp12_api_7x_64bit.so
│   ├── lib_rkisp1_api_6x_32bit.so
│   ├── lib_rkisp1_api_6x_64bit.so
│   ├── lib_rkisp1_api_7x_32bit.so
│   ├── lib_rkisp1_api_7x_64bit.so
│   ├── rk32xx_camera.mk
│   └── user.mk
└── SiliconImage                           // ISP 库，包括所有支持模组的驱动源码
    ├── Android.mk
    ├── include
    └── isi

```

**SiliconImage ISP 库-包括所有支持模组的驱动源码**

```txt

├── Android.mk
├── include
│   ├── adpcc
│   │   └── adpcc.h
│   ├── adpf
│   │   └── adpf.h
│   ├── aec
│   │   └── aec.h
│   ├── af
│   │   └── af.h
│   ├── avs
│   │   └── avs.h
│   ├── awb
│   │   ├── awb_common.h
│   │   ├── awb.h
│   │   ├── awb_v10.h
│   │   └── awb_v11.h
│   ├── awdr
│   │   └── awdr.h
│   ├── bufferpool
│   │   ├── media_buffer.h
│   │   ├── media_buffer_pool.h
│   │   ├── media_buffer_queue_ex.h
│   │   └── media_buffer_queue.h
│   ├── bufsync_ctrl
│   │   ├── bufsync_ctrl_api.h
│   │   └── bufsync_ctrl_common.h
│   ├── cam_calibdb
│   │   ├── cam_calibdb_api.h
│   │   └── cam_calibdb_common.h
│   ├── cam_engine
│   │   ├── cam_engine_aaa_api.h
│   │   ├── cam_engine_api.h
│   │   ├── cam_engine_common.h
│   │   ├── cam_engine_cproc_api.h
│   │   ├── cam_engine_drv_api.h
│   │   ├── cam_engine_imgeffects_api.h
│   │   ├── cam_engine_isp_api.h
│   │   ├── cam_engine_jpe_api.h
│   │   ├── cam_engine_mi_api.h
│   │   └── cam_engine_simp_api.h
│   ├── cameric_drv
│   │   ├── cameric_cproc_drv_api.h
│   │   ├── cameric_drv_api.h
│   │   ├── cameric_drv_common.h
│   │   ├── cameric_dual_cropping_drv_api.h
│   │   ├── cameric_ie_drv_api.h
│   │   ├── cameric_isp_afm_drv_api.h
│   │   ├── cameric_isp_awb_drv_api.h
│   │   ├── cameric_isp_bls_drv_api.h
│   │   ├── cameric_isp_cac_drv_api.h
│   │   ├── cameric_isp_cnr_drv_api.h
│   │   ├── cameric_isp_degamma_drv_api.h
│   │   ├── cameric_isp_dpcc_drv_api.h
│   │   ├── cameric_isp_dpf_drv_api.h
│   │   ├── cameric_isp_drv_api.h
│   │   ├── cameric_isp_elawb_drv_api.h
│   │   ├── cameric_isp_exp_drv_api.h
│   │   ├── cameric_isp_flash_drv_api.h
│   │   ├── cameric_isp_flt_drv_api.h
│   │   ├── cameric_isp_hist_drv_api.h
│   │   ├── cameric_isp_is_drv_api.h
│   │   ├── cameric_isp_lsc_drv_api.h
│   │   ├── cameric_isp_vsm_drv_api.h
│   │   ├── cameric_isp_wdr_drv_api.h
│   │   ├── cameric_jpe_drv_api.h
│   │   ├── cameric_mi_drv_api.h
│   │   ├── cameric_mipi_drv_api.h
│   │   ├── cameric_simp_drv_api.h
│   │   └── mainpage.h
│   ├── cameric_reg_drv
│   │   └── cameric_reg_description.h
│   ├── camsys_head.h
│   ├── common
│   │   ├── align.h
│   │   ├── array_size.h
│   │   ├── cam_cb.h
│   │   ├── cam_info.h
│   │   ├── cam_types.h
│   │   ├── cea_861.h
│   │   ├── hdmi_3d.h
│   │   ├── list.h
│   │   ├── mipi.h
│   │   ├── misc.h
│   │   ├── picture_buffer.h
│   │   ├── return_codes.h
│   │   └── utl_fixfloat.h
│   ├── common_head.h
│   ├── dom_ctrl
│   │   ├── dom_ctrl_api.h
│   │   └── dom_ctrl_common.h
│   ├── ebase
│   │   ├── builtins.h
│   │   ├── dct_assert.h
│   │   ├── ext_types.h
│   │   ├── hashtable.h
│   │   ├── linux_compat.h
│   │   ├── list.h
│   │   ├── mainpage.h
│   │   ├── queue.h
│   │   ├── return_types.h
│   │   ├── slist.h
│   │   ├── sort.frag.h
│   │   ├── trace.h
│   │   └── types.h
│   ├── exa_ctrl
│   │   ├── exa_ctrl_api.h
│   │   └── exa_ctrl_common.h
│   ├── hal
│   │   ├── hal_altera_pci.h
│   │   ├── hal_api.h
│   │   ├── hal_cosim.h
│   │   └── hal_mockup.h
│   ├── i2c_drv
│   │   └── i2c_drv.h
│   ├── ibd
│   │   ├── ibd_api.h
│   │   └── ibd_common.h
│   ├── isi
│   │   ├── isi_common.h
│   │   ├── isi.h
│   │   └── isi_iss.h
│   ├── isp_cam_api
│   │   ├── calib_xml
│   │   └── cam_api
│   ├── mim_ctrl
│   │   ├── mim_ctrl_api.h
│   │   └── mim_ctrl_common.h
│   ├── mipi_drv
│   │   ├── mipi_drv_api.h
│   │   └── mipi_drv_common.h
│   ├── mom_ctrl
│   │   ├── mom_ctrl_api.h
│   │   └── mom_ctrl_common.h
│   ├── oslayer
│   │   ├── oslayer.h
│   │   ├── oslayer_linux.h
│   │   ├── oslayer_linux.h.bak
│   │   ├── oslayer_mfs.h
│   │   ├── oslayer_systemc.h
│   │   ├── oslayer_ucosii.h
│   │   └── oslayer_win32.h
│   ├── som_ctrl
│   │   ├── som_ctrl_api.h
│   │   └── som_ctrl_common.h
│   ├── version
│   │   ├── version.h
│   │   └── version_number.h
│   └── vom_ctrl
│       ├── vom_ctrl_api.h
│       └── vom_ctrl_common.h
└── isi
    ├── Android.mk
    ├── drv
    │   ├── Android.mk
    │   ├── AR0330
    │   ├── GC0308
    │   ├── GC2035
    │   ├── GC2145
    │   ├── GC2155_CIF
    │   ├── GC2355
    │   ├── GC2385
    │   ├── GC5005
    │   ├── GC5025
    │   ├── GC8034
    │   ├── GS8604
    │   ├── Hi551
    │   ├── HM2057
    │   ├── HM5040
    │   ├── HM8040
    │   ├── IMX179
    │   ├── IMX214
    │   ├── IMX214_B
    │   ├── IMX258
    │   ├── IMX274
    │   ├── IMX278
    │   ├── IMX290
    │   ├── IMX291
    │   ├── IMX317
    │   ├── JX507
    │   ├── NT99252
    │   ├── OV13850
    │   ├── OV13860
    │   ├── OV14825
    │   ├── OV2659
    │   ├── OV2680
    │   ├── OV2685_MIPI_YUV
    │   ├── OV2686
    │   ├── OV2710
    │   ├── OV2715
    │   ├── OV2718
    │   ├── OV2735
    │   ├── OV4188
    │   ├── OV4689
    │   ├── OV5630
    │   ├── OV5640
    │   ├── OV5645_MIPI_YUV
    │   ├── OV5647
    │   ├── OV5648
    │   ├── OV5693
    │   ├── OV5695
    │   ├── OV7251
    │   ├── OV8810
    │   ├── OV8820
    │   ├── OV8825
    │   ├── OV8856
    │   ├── OV8858
    │   │   ├── Android.mk
    │   │   ├── calib
    │   │   │   ├── OV8858_000V47-F415B-BW5B0.xml
    │   │   │   ├── OV8858_CMK-CB0407-FV3.xml
    │   │   │   ├── OV8858_CMK-CB0692-FV1.xml
    │   │   │   ├── OV8858_COB910-B800BA-E_V1.0.xml
    │   │   │   ├── OV8858_COB910-B800BA-E_V3.0.xml
    │   │   │   ├── OV8858_COB910-B800BA-E.xml
    │   │   │   ├── OV8858_lens_LG-40108A7_OTP.xml
    │   │   │   ├── OV8858_lens_LG-9569A2_OTP.xml
    │   │   │   ├── OV8858_lens_LG-9569A2.xml
    │   │   │   ├── OV8858_lens_R5AV08.xml
    │   │   │   ├── OV8858_lens_SUNNY-3813A_OTP.xml
    │   │   │   ├── OV8858_lens_SUNNY-3813A.xml
    │   │   │   ├── OV8858_LG-40108A7.xml
    │   │   │   ├── OV8858_LG-9569A2.xml
    │   │   │   ├── OV8858_OIN8A32.xml
    │   │   │   ├── OV8858_R1A_lens_LG-9569A2_OTP.xml
    │   │   │   ├── OV8858_R1A_lens_LG-9569A2.xml
    │   │   │   ├── OV8858_R1A_lens_SUNNY-3813A_OTP.xml
    │   │   │   ├── OV8858_R1A_lens_SUNNY-3813A.xml
    │   │   │   ├── OV8858_R2A_lens_LG-40108A7_OTP.xml
    │   │   │   ├── OV8858_R2A_lens_LG-9569A2_OTP.xml
    │   │   │   ├── OV8858_R5AV08.xml
    │   │   │   ├── OV8858_SUNNY-3813A.xml
    │   │   │   └── OV8858.xml
    │   │   ├── include_priv
    │   │   │   └── OV8858_MIPI_priv.h
    │   │   └── source
    │   │       ├── OV8858_MIPI.c
    │   │       └── OV8858_tables.c

    │   ├── OV8865
    │   ├── OV9282
    │   ├── S5K4H8
    │   ├── SC031GS_PARREL_RAW
    │   ├── SP2509V
    │   ├── SP2518
    │   ├── SP2519
    │   ├── SP5506
    │   ├── TC358743XBG_MIPI_YUV
    │   └── TC358749XBG_MIPI_YUV
    ├── include
    │   ├── isi_common.h
    │   ├── isi.h
    │   └── isi_iss.h
    ├── include_priv
    │   └── isi_priv.h
    └── source
        ├── Android.mk
        ├── Android.mk.bak
        ├── isi.c
        └── isisup.c

```

## 配置过程

**原理图**

![ov8858_camera](/images/camera/ov8858_camera.png)

从原理图获取需要配置的引脚：GPIO2_B4/DVP_PDN0_H, GPIO2_B3/CIF_CLKO, MIPI_RST0/GPIO0_B0

**cam_board.xml**

```xml

<?xml version="1.0" ?>
<BoardFile>
		<BoardXmlVersion version="v0.0xf.0">
		</BoardXmlVersion>
		<CamDevie>
			<HardWareInfo>
				<Sensor>
					<SensorName name="OV8858" ></SensorName>                             <!--Sensor 名称-->
					<SensorLens name="LG-9569A2"></SensorLens>
					<SensorDevID IDname="CAMSYS_DEVID_SENSOR_1A"></SensorDevID>          <!--Sensor 软件标识-->
					<SensorHostDevID busnum="CAMSYS_DEVID_MARVIN" ></SensorHostDevID>  <!--采集控制器名称-->
					<SensorI2cBusNum busnum="1"></SensorI2cBusNum>    <!--Sensor 所连接的主控 I2C 通道号, 具体通道号请参考摄像头原理图连接主控的 I2C 通道号-->
					<SensorI2cAddrByte byte="2"></SensorI2cAddrByte>  <!--Sensor 寄存器地址长度-->
					<SensorI2cRate rate="100000"></SensorI2cRate>     <!--Sensor 的 I2C 频率,单位：Hz，用于设置 I2C 的频率-->
					<SensorAvdd name="NC" min="28000000" max="28000000" delay="0"></SensorAvdd>  <!--Sensor AVDD 的 PMU LDO 名称。如果不是连接到 PMU，那么只需填写 NC-->
					<SensorDvdd name="NC" min="12000000" max="12000000" delay="0"></SensorDvdd>  <!--Sensor DOVDD 的 PMU LDO 名称。如果不是连接到 PMU，那么只需填写 NC。注意 min 以及 max 值必须填写，这决定了 Sensor 的 IO 电压。-->
					<SensorDovdd name="NC" min="18000000" max="18000000" delay="5000"></SensorDovdd> <!--ensor DVDD 的 PMU LDO 名称。-->
					<SensorMclk mclk="24000000" delay="1000"></SensorMclk>  <!--Sensor 输入时钟频率, 单位：Hz，用于设置摄像头的时钟。-->
					<SensorGpioPwen ioname="NC" active="1" delay="1000"></SensorGpioPwen>   <!--Sensor Power 引脚。 直接填写名称即可, active 填写电源有效电平。-->
					<SensorGpioRst ioname="RK30_PIN0_PB0" active="0" delay="1000"></SensorGpioRst>  <!--Sensor Reset 引脚。直接填写名称即可，active 填写复位的有效电平。-->
					<SensorGpioPwdn ioname="RK30_PIN2_PB4" active="0" delay="0"></SensorGpioPwdn>  <!--Sensor PowerDown 引脚。直接填写名称即可，active 填写休眠的有效电平。-->
					<SensorFacing facing="back"></SensorFacing>            <!--选择 Sensor 作为前置还是后置-->
					<SensorInterface interface="MIPI"></SensorInterface>   <!--Sensor 的接口方式-->
					<SensorMirrorFlip mirror="0"></SensorMirrorFlip>        <!--Sensor 的镜像方式-->
					<SensorOrientation orientation="180"></SensorOrientation>   <!--Sensor 的角度信息-->
					<SensorPowerupSequence seq="1234"></SensorPowerupSequence>
					<SensorFovParemeter h="60.0" v="60.0"></SensorFovParemeter>
					<SensorAWB_Frame_Skip fps="15"></SensorAWB_Frame_Skip>
					<SensorPhy phyMode="CamSys_Phy_Mipi" lane="2"  phyIndex="0" sensorFmt="CamSys_Fmt_Raw_10b"></SensorPhy>  <!--物理接口设置-->
					<!--phyMode：Sensor 接口硬件连接方式，对 MIPI Sensor 来说，该值取 CamSys_Phy_Mipi
                                            lane：Sensor mipi 接口数据通道数
                                            phyIndex：Sensor MIPI 连接的主控 MIPI phy 编号
                                            sensorFmt：Sensor 输出数据格式,目前仅支持 CamSys_Fmt_Raw_10b
                                        -->
				</Sensor>
				<VCM>
					<VCMDrvName name="DW9714"></VCMDrvName>
					<VCMName name="HuaYong6505"></VCMName>
					<VCMI2cBusNum busnum="1"></VCMI2cBusNum>
					<VCMI2cAddrByte byte="0"></VCMI2cAddrByte>
					<VCMI2cRate rate="0"></VCMI2cRate>
					<VCMVdd name="NC" min="0" max="0" delay="0"></VCMVdd>
					<VCMGpioPower ioname="NC" active="0" delay="1000"></VCMGpioPower>
					<VCMGpioPwdn ioname="NC" active="0" delay="0"></VCMGpioPwdn>
					<VCMCurrent start="20" rated="80" vcmmax="100" stepmode="13"  drivermax="100"></VCMCurrent>
				</VCM>
				<Flash>
					<FlashName name="Internal"></FlashName>
					<FlashI2cBusNum busnum="0"></FlashI2cBusNum>
					<FlashI2cAddrByte byte="0"></FlashI2cAddrByte>
					<FlashI2cRate rate="0"></FlashI2cRate>
					<FlashTrigger ioname="NC" active="0"></FlashTrigger>
					<FlashEn ioname="NC" active="0"></FlashEn>
					<FlashModeType mode="1"></FlashModeType>
					<FlashLuminance luminance="0"></FlashLuminance>
					<FlashColorTemp colortemp="0"></FlashColorTemp>
				</Flash>
			</HardWareInfo>
			<SoftWareInfo>
				<AWB>
					<AWB_Auto support="1"></AWB_Auto>
					<AWB_Incandescent support="1"></AWB_Incandescent>
					<AWB_Fluorescent support="1"></AWB_Fluorescent>
					<AWB_Warm_Fluorescent support="1"></AWB_Warm_Fluorescent>
					<AWB_Daylight support="1"></AWB_Daylight>
					<AWB_Cloudy_Daylight support="1"></AWB_Cloudy_Daylight>
					<AWB_Twilight support="1"></AWB_Twilight>
					<AWB_Shade support="1"></AWB_Shade>
				</AWB>
				<Sence>
					<Sence_Mode_Auto support="1"></Sence_Mode_Auto>
					<Sence_Mode_Action support="1"></Sence_Mode_Action>
					<Sence_Mode_Portrait support="1"></Sence_Mode_Portrait>
					<Sence_Mode_Landscape support="1"></Sence_Mode_Landscape>
					<Sence_Mode_Night support="1"></Sence_Mode_Night>
					<Sence_Mode_Night_Portrait support="1"></Sence_Mode_Night_Portrait>
					<Sence_Mode_Theatre support="1"></Sence_Mode_Theatre>
					<Sence_Mode_Beach support="1"></Sence_Mode_Beach>
					<Sence_Mode_Snow support="1"></Sence_Mode_Snow>
					<Sence_Mode_Sunset support="1"></Sence_Mode_Sunset>
					<Sence_Mode_Steayphoto support="1"></Sence_Mode_Steayphoto>
					<Sence_Mode_Pireworks support="1"></Sence_Mode_Pireworks>
					<Sence_Mode_Sports support="1"></Sence_Mode_Sports>
					<Sence_Mode_Party support="1"></Sence_Mode_Party>
					<Sence_Mode_Candlelight support="1"></Sence_Mode_Candlelight>
					<Sence_Mode_Barcode support="1"></Sence_Mode_Barcode>
					<Sence_Mode_HDR support="1"></Sence_Mode_HDR>
				</Sence>
				<Effect>
					<Effect_None support="1"></Effect_None>
					<Effect_Mono support="1"></Effect_Mono>
					<Effect_Solarize support="1"></Effect_Solarize>
					<Effect_Negative support="1"></Effect_Negative>
					<Effect_Sepia support="1"></Effect_Sepia>
					<Effect_Posterize support="1"></Effect_Posterize>
					<Effect_Whiteboard support="1"></Effect_Whiteboard>
					<Effect_Blackboard support="1"></Effect_Blackboard>
					<Effect_Aqua support="1"></Effect_Aqua>
				</Effect>
				<FocusMode>
					<Focus_Mode_Auto support="1"></Focus_Mode_Auto>
					<Focus_Mode_Infinity support="1"></Focus_Mode_Infinity>
					<Focus_Mode_Marco support="1"></Focus_Mode_Marco>
					<Focus_Mode_Fixed support="1"></Focus_Mode_Fixed>
					<Focus_Mode_Edof support="1"></Focus_Mode_Edof>
					<Focus_Mode_Continuous_Video support="0"></Focus_Mode_Continuous_Video>
					<Focus_Mode_Continuous_Picture support="1"></Focus_Mode_Continuous_Picture>
				</FocusMode>
				<FlashMode>
					<Flash_Mode_Off support="1"></Flash_Mode_Off>
					<Flash_Mode_On support="1"></Flash_Mode_On>
					<Flash_Mode_Torch support="1"></Flash_Mode_Torch>
					<Flash_Mode_Auto support="1"></Flash_Mode_Auto>
					<Flash_Mode_Red_Eye support="1"></Flash_Mode_Red_Eye>
				</FlashMode>
				<AntiBanding>
					<Anti_Banding_Auto support="1"></Anti_Banding_Auto>
					<Anti_Banding_50HZ support="1"></Anti_Banding_50HZ>
					<Anti_Banding_60HZ support="1"></Anti_Banding_60HZ>
					<Anti_Banding_Off support="1"></Anti_Banding_Off>
				</AntiBanding>
				<HDR support="1"></HDR>
				<ZSL support="1"></ZSL>
				<DigitalZoom support="1"></DigitalZoom>
				<Continue_SnapShot support="1"></Continue_SnapShot>
				<InterpolationRes resolution="0"></InterpolationRes>
				<PreviewSize width="1920" height="1080"></PreviewSize>
				<FaceDetect support="0" MaxNum="1"></FaceDetect>
				<DV>
					<DV_QCIF name="qcif" width="176" height="144" fps="10" support="1"></DV_QCIF>
					<DV_QVGA name="qvga" width="320" height="240" fps="10" support="1"></DV_QVGA>
					<DV_CIF name="cif" width="352" height="288" fps="10" support="1"></DV_CIF>
					<DV_VGA name="480p" width="640" height="480" fps="10" support="0"></DV_VGA>
					<DV_480P name="480p" width="720" height="480" fps="10" support="0"></DV_480P>
					<DV_720P name="720p" width="1280" height="720" fps="10" support="1"></DV_720P>
					<DV_1080P name="1080p" width="1920" height="1080" fps="10" support="1"></DV_1080P>
				</DV>
			</SoftWareInfo>
		</CamDevie>
</BoardFile>


```

## I2C 波形样张

![mipi_camera_i2c](/images/camera/mipi_camera_i2c.jpg)

## 时钟波形信号

![mipi_camera_clock](/images/camera/mipi_camera_clock.jpg)

## IMX258 驱动调试

```txt

[   15.002593] E:camsys_i2c_write(92): i2c write dev(addr:0x20) failed!,err = -6
[   15.004566] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-1!
[   15.004794] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-0!
[   15.005182] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-1!
[   15.005364] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-0!
[   15.005609] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-1!
[   15.005797] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-0!
[   15.006062] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-1!
[   15.006244] E:camsys_i2c_read(152): i2c read dev(addr:0xa0) failed,tryagain-0!


```

如果调用 I2C 传输接口返回值为 -6(-ENXIO)时候，表示为 NACK 错误，即对方设备无应答响应，这种情况一
般为外设的问题，常见的有以下几种情况：

1. I2C 地址错误；
2. I2C slave 设备处于不正常工作状态，比如没有上电，错误的上电时序以及设备异常等；
3. I2C 时序不符合slave设备所要求也会产生 NACK 信号，比如 slave 设备需要的是 stop 信号,而不是repeat start 信号的时候；
4. I2C 总线受外部干扰导致的，用示波器测量可以看到是一个ACK波形


















































